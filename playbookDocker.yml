- hosts: webservers
  become: true
  become_user: root
  vars_files:
    - myvariables.yml
  tasks:
    - name: Install multiple packages on host server
      package: name={{item}} state=present
      loop:
        - git
        - docker
        - nano
        - tree
    - name: Start Docker service
      service: name=docker state=started
    - name: Clone a github repo which has dockerfile
      git: repo={{repo_path}} dest={{dest_path}}
    - name: Build the dockerfile
      command: chdir={{dest_path}} docker build -t {{image_name}} .
    - name: run the image to launch a container
      command: docker run -d -P {{image_name}}
